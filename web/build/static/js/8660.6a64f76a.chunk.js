"use strict";(self.webpackChunkweb_ui_react=self.webpackChunkweb_ui_react||[]).push([[8660],{38660:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var s=a(65043),r=a(91686),n=a(96464),c=a(49415),o=a(7250),l=a(63681),u=a(35601),d=a(70579);const{Text:i}=n.A,p=()=>{const{state:e,dispatch:t}=(0,c.nm)(),[a,n]=(0,s.useState)(null),[p,y]=(0,s.useState)(!1),[T,g]=(0,s.useState)(""),f=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y(!0),t({type:c.TH.SET_LOADING,payload:{key:"state",value:!0}});try{const a=await o.A.getInfrastructureState(e);n(a),t({type:c.TH.SET_INFRASTRUCTURE_STATE,payload:a})}catch(a){console.error("Failed to load infrastructure state:",a)}finally{y(!1),t({type:c.TH.SET_LOADING,payload:{key:"state",value:!1}})}},[t]),h=(0,s.useCallback)(e=>{switch(console.log("InfrastructureStatePage: Handling WebSocket message:",e.type,e),e.type){case"state_update":n(e.data),t({type:c.TH.SET_INFRASTRUCTURE_STATE,payload:e.data});break;case"processing_completed":e.success&&setTimeout(()=>{f(!1)},1e3)}},[t,f]);(0,s.useEffect)(()=>{const e=(0,l.js)();return t({type:c.TH.SET_CURRENT_PAGE,payload:"infrastructure-state"}),t({type:c.TH.REGISTER_PAGE_HANDLER,payload:{page:"infrastructure-state",handler:h}}),()=>{e(),t({type:c.TH.UNREGISTER_PAGE_HANDLER,payload:"infrastructure-state"}),t({type:c.TH.SET_CURRENT_PAGE,payload:null})}},[t,h]),(0,s.useEffect)(()=>{f()},[f]);const _=(()=>{if(!a)return{};let e={};const t=a.resources&&a.resources.length>0,s=a.managed_state?Object.keys(a.managed_state.resources||{}).length:0;a.managed_state&&s>0?e=a.managed_state.resources||{}:t&&(e={},a.resources.forEach((t,a)=>{var s;e[t.id||"resource-".concat(a)]={id:t.id,name:t.name||t.id,type:t.type,status:t.status,properties:{aws_details:t.properties},createdAt:t.createdAt,dependencies:null===(s=t.properties)||void 0===s?void 0:s.dependencies}}));return Object.values(e).filter(e=>"step_reference"!==e.type).filter(e=>!T||e.id.toLowerCase().includes(T.toLowerCase())).reduce((e,t)=>{const a=t.type||"unknown";return e[a]||(e[a]=[]),e[a].push(t),e},{})})(),E=Object.values(_).flat().length;return(0,d.jsxs)("div",{style:{padding:"24px",minHeight:"100vh",backgroundColor:"#fafafa"},children:[(0,d.jsx)(u.l3,{onRefresh:()=>f(!1),refreshing:p,searchTerm:T,onSearchChange:e=>g(e.target.value),totalResources:E,totalCategories:Object.keys(_).length}),e.loading.state?(0,d.jsxs)("div",{style:{textAlign:"center",padding:"80px 0",backgroundColor:"white",borderRadius:"16px",border:"1px solid #e8e8e8"},children:[(0,d.jsx)(r.A,{size:"large"}),(0,d.jsx)("div",{style:{marginTop:24},children:(0,d.jsx)(i,{type:"secondary",style:{fontSize:"16px"},children:"Loading infrastructure resources..."})})]}):(0,d.jsx)(u.Rt,{infrastructureData:a,searchTerm:T})]})}}}]);
//# sourceMappingURL=8660.6a64f76a.chunk.js.map