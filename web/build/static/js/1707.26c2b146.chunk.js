"use strict";(self.webpackChunkweb_ui_react=self.webpackChunkweb_ui_react||[]).push([[1707],{1707:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var a=s(9379),n=s(5043),o=s(2261),r=s(5492),c=s(5520),i=s(6368),l=s(777),d=s(2019),p=s(6051),y=s(6464),u=s(6087),E=s(8397),g=s(4510),T=s(9415),S=s(7250),_=s(9466),m=s(579);const{TextArea:A}=l.A,{Text:I,Paragraph:x}=y.A,h=()=>{var e,t;const{state:s,dispatch:l}=(0,T.nm)(),[y,h]=(0,n.useState)(""),[v,R]=(0,n.useState)(!0),[O,f]=(0,n.useState)(null),C=(0,n.useRef)(null),P=(0,n.useCallback)(()=>{const e=new Date,t=setInterval(()=>{const t=new Date,s=Math.floor((t-e)/1e3),a=Math.floor(s/60),n=s%60,o="".concat(a.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"));l({type:T.TH.SET_AGENT_EXECUTION_ELAPSED,payload:o})},1e3);f(t)},[l]),b=(0,n.useCallback)(()=>{O&&(clearInterval(O),f(null))},[O]),k=(0,n.useCallback)((e,t)=>{l({type:T.TH.UPDATE_STEP_STATUS,payload:{stepId:e,status:t}})},[l]),N=(0,n.useCallback)(()=>{l({type:T.TH.UPDATE_EXECUTION_PROGRESS})},[l]),w=(0,n.useCallback)(e=>{l({type:T.TH.ADD_AGENT_EXECUTION_LOG,payload:(0,a.A)((0,a.A)({},e),{},{timestamp:new Date})})},[l]),H=(0,n.useCallback)((e,t,s)=>{l({type:T.TH.SET_RECOVERY_OPTIONS,payload:{stepId:s,failureContext:e,recoveryOptions:t,visible:!0}})},[l]),U=(0,n.useCallback)(async(e,t)=>{l({type:T.TH.SET_RECOVERY_OPTIONS,payload:{stepId:e,failureContext:null,recoveryOptions:[],visible:!1,inProgress:!0,selectedOption:t}});try{if(s.websocket&&s.websocket.readyState===WebSocket.OPEN){const a={type:"recovery_decision",stepId:e,selectedOptionIndex:String(t),timestamp:(new Date).toISOString()};s.websocket.send(JSON.stringify(a)),w({type:"info",message:"Recovery option selected: ".concat("skip"===t?"Skip Step":"Option ".concat(parseInt(t)+1)),stepId:e})}}catch(a){console.error("Failed to send recovery decision:",a),w({type:"error",message:"Failed to communicate recovery decision to server",stepId:e})}},[l,s.websocket,w]),G=(0,n.useCallback)(async e=>{l({type:T.TH.CLEAR_RECOVERY_OPTIONS});try{if(s.websocket&&s.websocket.readyState===WebSocket.OPEN){const t={type:"recovery_abort",stepId:e,timestamp:(new Date).toISOString()};s.websocket.send(JSON.stringify(t)),w({type:"error",message:"Execution aborted by user during recovery",stepId:e})}}catch(t){console.error("Failed to send recovery abort:",t)}b(),l({type:T.TH.UPDATE_EXECUTION_STATUS,payload:"aborted"})},[l,s.websocket,w,b]),j=(0,n.useCallback)(e=>{switch(e.type){case"processing_started":l({type:T.TH.SET_STATUS_MESSAGE,payload:"Processing: ".concat(e.request)}),l({type:T.TH.SET_LOADING,payload:{key:"agent",value:!0}});break;case"processing_completed":e.success?l({type:T.TH.SET_STATUS_MESSAGE,payload:"Processing completed successfully"}):l({type:T.TH.SET_STATUS_MESSAGE,payload:"Processing failed"}),l({type:T.TH.SET_LOADING,payload:{key:"agent",value:!1}});break;case"execution_started":P(),l({type:T.TH.SET_AGENT_EXECUTION_COMPLETED,payload:!1}),l({type:T.TH.SET_AGENT_EXECUTION_PROGRESS,payload:0}),w({type:"info",message:e.message||"Execution started",stepId:null});break;case"step_started":k(e.stepId,"running"),w({type:"info",message:e.message,stepId:e.stepId});break;case"step_progress":w({type:"info",message:e.message,stepId:e.stepId});break;case"step_completed":k(e.stepId,"completed"),N(),w({type:"success",message:e.message,stepId:e.stepId});break;case"step_failed":k(e.stepId,"failed"),w({type:"error",message:e.message,stepId:e.stepId});break;case"execution_completed":b(),l({type:T.TH.SET_AGENT_EXECUTION_PROGRESS,payload:100}),l({type:T.TH.SET_AGENT_EXECUTION_COMPLETED,payload:!0}),l({type:T.TH.UPDATE_EXECUTION_STATUS,payload:"completed"}),w({type:"success",message:e.message||"Execution completed successfully",stepId:null}),d.Ay.success("Execution completed successfully"),setTimeout(()=>{l({type:T.TH.REFRESH_INFRASTRUCTURE})},1e3);break;case"execution_aborted":b(),l({type:T.TH.SET_AGENT_EXECUTION_COMPLETED,payload:!0}),l({type:T.TH.UPDATE_EXECUTION_STATUS,payload:"aborted"}),w({type:"error",message:e.message||"Execution was aborted",stepId:null}),d.Ay.error("Execution was aborted");break;case"step_recovery_generating":k(e.stepId,"recovery-generating"),w({type:"warning",message:e.message||"Generating recovery options...",stepId:e.stepId});break;case"step_recovery_needed":k(e.stepId,"recovery-pending"),w({type:"warning",message:e.message||"Recovery options available",stepId:e.stepId}),H(e.failureContext,e.recoveryOptions,e.stepId);break;case"step_recovery_started":k(e.stepId,"recovery-in-progress"),w({type:"info",message:e.message||"Starting recovery...",stepId:e.stepId});break;case"step_recovery_progress":w({type:"info",message:e.message,stepId:e.stepId}),l({type:T.TH.UPDATE_RECOVERY_PROGRESS,payload:{stepId:e.stepId,message:e.message}});break;case"step_recovery_completed":k(e.stepId,"completed"),N(),w({type:"success",message:e.message||"Recovery completed successfully",stepId:e.stepId}),l({type:T.TH.CLEAR_RECOVERY_OPTIONS,payload:{stepId:e.stepId}});break;case"step_recovery_failed":k(e.stepId,"failed"),w({type:"error",message:e.message||"Recovery failed",stepId:e.stepId}),l({type:T.TH.CLEAR_RECOVERY_OPTIONS,payload:{stepId:e.stepId}})}},[l,P,b,k,N,w,H]);(0,n.useEffect)(()=>{const{websocket:e}=s;if(!e)return;const t=e=>{try{const t=JSON.parse(e.data);j(t)}catch(t){console.error("AIAgentPage: Failed to parse WebSocket message:",t)}};return e.addEventListener("message",t),()=>{e.removeEventListener("message",t)}},[s.websocket,j]),(0,n.useEffect)(()=>()=>{O&&clearInterval(O)},[O]);const D=async()=>{if(y.trim()){l({type:T.TH.CLEAR_AGENT_RESPONSE}),b(),l({type:T.TH.SET_LOADING,payload:{key:"agent",value:!0}});try{const e=await S.A.processAgentRequest(y,v);l({type:T.TH.SET_AGENT_RESPONSE,payload:e}),e.executionPlan&&e.executionPlan.length>0&&l({type:T.TH.SET_AGENT_EXECUTION_PLAN,payload:e.executionPlan}),l({type:T.TH.SET_STATUS_MESSAGE,payload:"Request processed successfully"})}catch(e){console.error("Agent request failed:",e),l({type:T.TH.CLEAR_AGENT_RESPONSE});let t="Failed to process request";500===e.status?t="Server error occurred. Please try again or check with your administrator.":400===e.status?t=e.message||"Invalid request. Please check your input and try again.":401===e.status?t="Authentication required. Please log in and try again.":403===e.status?t="You do not have permission to perform this action.":404===e.status?t="Service not found. Please check your configuration.":429===e.status?t="Too many requests. Please wait a moment and try again.":e.message&&"Failed to fetch"!==e.message?t=e.message:"Failed to fetch"===e.message&&(t="Unable to connect to server. Please check your internet connection and try again."),d.Ay.error(t),l({type:T.TH.SET_STATUS_MESSAGE,payload:"Error: ".concat(t)})}finally{l({type:T.TH.SET_LOADING,payload:{key:"agent",value:!1}})}}else d.Ay.warning("Please enter a request")},L=async()=>{var e,t;if(null!==(e=s.agentResponse)&&void 0!==e&&null!==(t=e.decision)&&void 0!==t&&t.id){l({type:T.TH.SET_LOADING,payload:{key:"agent",value:!0}});try{if(l({type:T.TH.SET_AGENT_EXECUTION_LOGS,payload:[]}),l({type:T.TH.SET_AGENT_EXECUTION_PROGRESS,payload:0}),l({type:T.TH.SET_AGENT_EXECUTION_COMPLETED,payload:!1}),b(),s.agentExecutionPlan){const e=s.agentExecutionPlan.map(e=>(0,a.A)((0,a.A)({},e),{},{status:"pending"}));l({type:T.TH.SET_AGENT_EXECUTION_PLAN,payload:e})}await S.A.executeConfirmedPlan(s.agentResponse.decision.id),l({type:T.TH.SET_CURRENT_EXECUTION,payload:{status:"running",decisionId:s.agentResponse.decision.id}}),v?d.Ay.success("Dry run execution started"):d.Ay.success("Execution started"),setTimeout(()=>{C.current&&C.current.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},200)}catch(n){console.error("Execution start failed:",n);let e="Failed to start execution";500===n.status?e="Server error occurred while starting execution. Please try again.":400===n.status?e=n.message||"Invalid execution request. Please regenerate the plan and try again.":404===n.status?e="Execution plan not found. Please regenerate the plan and try again.":409===n.status?e="Another execution is already in progress. Please wait for it to complete.":n.message&&"Failed to fetch"!==n.message?e=n.message:"Failed to fetch"===n.message&&(e="Unable to connect to server. Please check your connection and try again."),d.Ay.error(e),l({type:T.TH.SET_STATUS_MESSAGE,payload:"Error: ".concat(e)})}finally{l({type:T.TH.SET_LOADING,payload:{key:"agent",value:!1}})}}else d.Ay.error("No execution plan to confirm")},M=()=>{l({type:T.TH.CLEAR_AGENT_RESPONSE}),b(),d.Ay.info("Plan cancelled")},X=()=>{var e;const t=Array.isArray(s.agentExecutionLogs)?s.agentExecutionLogs:[],a=v?"Execution Plan (Dry Run)":"Execution Plan",n=v?"Confirm & Execute (Dry Run)":"Confirm & Execute";return(0,m.jsx)("div",{ref:C,style:{scrollMarginTop:"100px"},children:(0,m.jsx)(_.wW,{steps:s.agentExecutionPlan,logs:t,isExecuting:"running"===(null===(e=s.currentExecution)||void 0===e?void 0:e.status),executionProgress:s.agentExecutionProgress,executionElapsed:s.agentExecutionElapsed,executionCompleted:s.agentExecutionCompleted,recoveryOptions:s.recoveryOptions,onConfirm:L,onCancel:M,onProceedWithRecovery:U,onAbortRecovery:G,showConfirmButton:!0,showCancelButton:!0,confirmButtonText:n,title:a})})};return(0,m.jsxs)("div",{style:{maxWidth:1200,margin:"0 auto"},children:[(0,m.jsx)(_.zY,{title:"Single Prompt Execute",description:"Describe what you want to do with your infrastructure in natural language."}),(0,m.jsx)(_.RD,{message:s.statusMessage,type:null!==(e=s.statusMessage)&&void 0!==e&&e.startsWith("Error:")?"error":void 0,showIcon:null===(t=s.statusMessage)||void 0===t?void 0:t.startsWith("Error:")}),(0,m.jsx)(c.A,{children:(0,m.jsxs)(p.A,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,m.jsx)(A,{placeholder:"Example: Create a new VPC with 2 subnets and an auto-scaling group with 3 EC2 instances running nginx",value:y,onChange:e=>h(e.target.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&D()},rows:4,style:{fontSize:16}}),(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,m.jsx)(i.A,{checked:v,onChange:e=>R(e.target.checked),children:"Dry Run Mode"}),(0,m.jsx)(r.Ay,{type:"primary",size:"large",icon:(0,m.jsx)(E.A,{}),onClick:D,loading:s.loading.agent,disabled:!y.trim(),children:"Process Request"})]}),(0,m.jsx)("div",{style:{fontSize:12,color:"#666"},children:"Tip: Press Ctrl+Enter (Cmd+Enter on Mac) to quickly process your request"})]})}),!s.agentResponse||s.loading.agent?null:(0,m.jsx)(c.A,{title:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(u.A,{})," AI Agent Response"]}),style:{marginTop:16},children:(0,m.jsxs)(p.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,m.jsx)(o.A,{message:"Request Processed",description:(0,m.jsxs)("div",{children:[(0,m.jsxs)(x,{children:[(0,m.jsx)("strong",{children:"Request:"})," ",s.agentResponse.request]}),(0,m.jsxs)(x,{children:[(0,m.jsx)("strong",{children:"Mode:"})," ","demo"===s.agentResponse.mode?"Demo Mode":s.agentResponse.dry_run?"Dry Run":"Live Execution"]}),(0,m.jsxs)(x,{children:[(0,m.jsx)("strong",{children:"Confidence:"})," ",(100*s.agentResponse.confidence).toFixed(1),"%"]})]}),type:"info",showIcon:!0}),"demo"===s.agentResponse.mode&&(0,m.jsx)(c.A,{size:"small",title:"Response",children:(0,m.jsx)(I,{children:s.agentResponse.response})}),"live"===s.agentResponse.mode&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.A,{size:"small",title:"Action",children:(0,m.jsx)(I,{children:s.agentResponse.action})}),(0,m.jsx)(c.A,{size:"small",title:"Reasoning",children:(0,m.jsx)("div",{className:"reasoning-content",children:(0,m.jsx)(g.oz,{children:s.agentResponse.reasoning})})})]}),s.agentExecutionPlan&&X()]})})]})}}}]);
//# sourceMappingURL=1707.26c2b146.chunk.js.map